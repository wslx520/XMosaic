!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():t.XMosaic=e()}(this,function(){"use strict";function t(e,n){return new t.main(e,n)}function e(t){return 1- --t*t*t*t}var n=Array.prototype.slice,o={id:function(t){return"string"==typeof t?document.getElementById(t):t},Extend:function(t,e){for(var n in e)t[n]=e[n];return t},Bind:function(t,e){var o=n.call(arguments).slice(2);return function(){return e.apply(t,o.concat(n.call(arguments)))}},Create:function(t,e){var n=document.createElement(t);for(var o in e)n.setAttribute(o,e[o]);return n},On:function(){return window.addEventListener?function(t,e,n){n.addEventListener(t,e,!1)}:function(t,e,n){n.attachEvent("on"+t,e)}}(),cutover:function(t,e,n){for(var o=0,i=t.length;i>o;o++)-1!=t[o].className.indexOf(n)&&(t[o].className=t[o].className.replace(n,""));t[e].className=t[e].className.replace(/\s$/g,"")+" "+n},setAlpha:function(){return-[1]?function(t,e){t.style.opacity=.01*e}:function(t,e){t.style.filter="alpha(opacity="+e+")"}}(),forEach:function(t,e){for(var n=0,o=t.length;o>n;n++)e(t[n],n,t)}},i=function(t){for(var e,n,o=t.length;o;e=parseInt(Math.random()*o),n=t[--o],t[o]=t[e],t[e]=n);return t};return t.main=function(t,e){var n=this;n.wraper=o.id(t),n.items=n.wraper.children,n.number=n.items.length,n.What=["top","left","height","width"],n.fan=1,n.now=n.next=0,n.options=n.reset(e),n.Width=n.options.Width||n.wraper.offsetWidth,n.Height=n.options.Height||n.wraper.offsetHeight,n.how=n.options.how,n.order=n.options.order,n.auto=n.options.auto,n.event=n.options.event,n.initial()},t.prototype={reset:function(t){var e={countX:5,countY:5,how:0,doing:500,delay:4e3,order:0,event:"mouseover",auto:!0};return o.Extend(e,t)},initial:function(){var t=this,e=t.options;t.images=function(){for(var e=[],n=0,o=t.items.length;o>n;n++)e.push(t.items[n].getElementsByTagName("IMG")[0]);return e}(),t.count=e.countX*e.countY,t.changeNow=e.changeNow?1:0,t.delay=e.delay,t.speed=Math.floor(e.doing/t.count),t.sWidth=t.Width/e.countX,t.sHeight=t.Height/e.countY;var n={x:0,y:0};t.smalls=[],t.wraper.style.position="relative";for(var i=0;i<t.number;t.items[i++].style.cssText+="position:absolute; top:0;left:0;");if(t.how>0&&(t.what=t.What[t.how%2],t.how>2&&(t.fan=-1,t.how>6))){t.what=t.What[t.how%2+2];var r=1}t.bigDIV=function(){if(!o.id("MosaicInner")){for(var e=o.Create("A",{"class":"MosaicInner",target:"_blank",id:"MosaicInner"}),i=0;i<t.count;i++){var a=o.Create("DIV",{id:"div"+i});a.style.cssText="float:left; position:absolute;background:url() 50% 50% no-repeat; width:"+t.sWidth+"px; height:"+t.sHeight+"px;left:"+n.x*t.sWidth+"px;top:"+n.y*t.sHeight+"px; background-position:"+-n.x*t.sWidth+"px "+-n.y*t.sHeight+"px; width:"+t.sWidth+"px; height:"+t.sHeight+"px;",o.setAlpha(a,0),a.e=parseInt(a.style[t.what]),a.h=parseInt(a.style.height),a.w=parseInt(a.style.width),a.b=a.e-(r?a.e:100*t.fan),a.c=a.e-a.b,t.how>4&&t.how<7&&i%2&&(a.b=a.b+a.c,a.c=a.b-a.c,a.b=a.b-a.c),n.x++,n.x>t.options.countX-1&&(n.x=0,n.y++),t.smalls.push(e.appendChild(a))}return e.style.cssText="position:absolute; display:block; top:0; left:0; width:"+t.Width+"px;height:"+t.Height+"px;z-index:99;",e}}(),t.wraper.appendChild(t.bigDIV),t.items[0].style.zIndex=10,t.Run=t.run(),t.pager=o.id(e.pager),t.pager&&t.Pager(),t.auto&&(t.timer=setTimeout(o.Bind(t,t.Next),t.delay))},go:function(t){var e=this;clearTimeout(e.timer);for(var n=0,i=e.count;i>n;clearTimeout(e.smalls[n++].timer));if(e._time=0,e.curS=e.items[e.now],void 0!=t?e.next=t:e.next=e.now+1,e.next>=e.number&&(e.next=0)||e.next<0&&(e.next=e.number-1),e.next!=e.now){for(var n=0,i=e.number;i>n;n++)n!=e.now&&(e.items[n].style.zIndex=5);e.curS.style.zIndex=10,e.nextS=e.items[e.next],e.going=0,e.bigDIV.style.display="block",e.Run(),e.pager&&o.cutover(e.pages,e.next,"on"),e.now=e.next}},run:function(){var t=this,n=t.speed,r=t.count,a=t.how,s=t.what,u=t.smalls,c=t.order;if(4==c){for(var h=[],l=0;r>l;h.push(l++));for(var f,p,d,g,l=0;r>l;l++)d=r-l,g=d-1,p=Math.floor(Math.random()*d),f=h[g],h[g]=h[p],h[p]=f}var m=function(){var t=[function(t){return t},function(t){return r-t},function(t){return Math.floor(Math.abs(t-(r-1)/2))},function(t){return t>=(r-1)/2&&(t=r-1-t)||t},function(t){return h[t]},function(t){return 0}];return t[c]}();return function(){this.nowPic=this.images[this.next];var r=this.nowPic.src;h&&i(h),o.forEach(u,function(i,u){i.style.backgroundImage="url("+r+")",i.end=0,o.setAlpha(i,0),i.style[s]=i.b+"px",i.todo=function(){(i.end+=5)<100?(o.setAlpha(i,i.end),i.style[s]=Math.floor(i.b+e(i.end/100)*i.c)+"px",9==a&&(i.style.height=Math.floor(e(i.end/100)*i.h)+"px"),i.timer=setTimeout(i.todo,20)):(i.end=0,i.style[s]=i.e+"px",9==a&&(i.style.height=i.h+"px"),o.setAlpha(i,100),t.going++,t.going==t.count&&t.after())},u=m(u),i.timer=setTimeout(i.todo,n*u)})}},after:function(){var t=this;t.going==t.count&&(t.going=0,t.bigDIV.style.display="none",t.curS.style.zIndex=5,t.nextS.style.zIndex=10,t.auto&&(t.timer=setTimeout(o.Bind(t,t.Next),t.delay)))},Pager:function(){var t=this;t.pages=o.id(t.pager).children;for(var e,n=t.event,i=t.pages.length,r=0;i>r;r++)!function(i){o.On(n,function(){t.Pause(),e=setTimeout(function(){t.go(i)},150)},t.pages[i]),o.On("mouseout",function(){clearTimeout(e),t.options.auto&&(t.auto=!0)},t.pages[i])}(r)},Prev:function(){this.go(--this.next)},Next:function(){this.go(++this.next)},Pause:function(){clearTimeout(this.timer),this.auto=!1},Cont:function(){clearTimeout(this.timer),this.auto=!0,this.timer=setTimeout(o.Bind(this,this.Next),this.delay)}},t.main.prototype=t.prototype,t});